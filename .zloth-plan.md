# Implementation Plan: Executor Tab in Settings

## Overview
Add a new "Executors" tab to the Settings page that allows users to check the availability of CLI executors (Claude Code, Codex, Gemini).

## Current Architecture Summary

### Frontend Settings
- **File**: `apps/web/src/components/SettingsModal.tsx`
- **Tab Config**: `settingsTabConfig` array defines tabs with `id`, `label`, and `icon`
- **Tab Type**: `SettingsTabType = 'models' | 'github' | 'defaults'`
- **Tabs**: ModelsTab, GitHubAppTab, DefaultsTab (all in SettingsModal.tsx)

### Backend Executors
- **Claude Code**: `apps/api/src/zloth_api/executors/claude_code_executor.py`
  - Uses `ZLOTH_CLAUDE_CLI_PATH` (default: `claude`)
  - Error: `FileNotFoundError` when CLI not found
- **Codex**: `apps/api/src/zloth_api/executors/codex_executor.py`
  - Uses `ZLOTH_CODEX_CLI_PATH` (default: `codex`)
  - Error: `FileNotFoundError` when CLI not found
- **Gemini**: `apps/api/src/zloth_api/executors/gemini_executor.py`
  - Uses `ZLOTH_GEMINI_CLI_PATH` (default: `gemini`)
  - Error: `FileNotFoundError` when CLI not found

### Configuration
- **File**: `apps/api/src/zloth_api/config.py`
- Settings:
  - `claude_cli_path: str = "claude"`
  - `codex_cli_path: str = "codex"`
  - `gemini_cli_path: str = "gemini"`

---

## Implementation Steps

### Step 1: Backend - Create Executors Status Endpoint

**File**: `apps/api/src/zloth_api/routes/executors.py` (new file)

Create a new route module that provides an endpoint to check executor availability:

```python
# GET /executors/status
# Response: {
#   "claude_code": { "available": true, "path": "claude", "version": "..." },
#   "codex_cli": { "available": false, "path": "codex", "error": "CLI not found" },
#   "gemini_cli": { "available": true, "path": "gemini", "version": "..." }
# }
```

Implementation approach:
1. For each executor, run a simple version check command (e.g., `claude --version`)
2. Use `asyncio.create_subprocess_exec` with a short timeout
3. Return availability status, configured path, and version (if available)

### Step 2: Backend - Register Route in Main

**File**: `apps/api/src/zloth_api/main.py`

Register the new executors router:
```python
from zloth_api.routes import executors
app.include_router(executors.router, prefix="/executors", tags=["executors"])
```

### Step 3: Frontend - Add TypeScript Types

**File**: `apps/web/src/types.ts`

Add new types for executor status:
```typescript
export interface ExecutorStatus {
  available: boolean;
  path: string;
  version?: string;
  error?: string;
}

export interface ExecutorsStatus {
  claude_code: ExecutorStatus;
  codex_cli: ExecutorStatus;
  gemini_cli: ExecutorStatus;
}
```

### Step 4: Frontend - Add API Client

**File**: `apps/web/src/lib/api.ts`

Add new API client for executors:
```typescript
export const executorsApi = {
  getStatus: () => fetchApi<ExecutorsStatus>('/executors/status'),
};
```

### Step 5: Frontend - Update Settings Tab Config

**File**: `apps/web/src/components/SettingsModal.tsx`

1. Update `SettingsTabType`:
   ```typescript
   export type SettingsTabType = 'models' | 'github' | 'defaults' | 'executors';
   ```

2. Add to `settingsTabConfig`:
   ```typescript
   { id: 'executors', label: 'Executors', icon: <CommandLineIcon className="w-4 h-4" /> },
   ```

3. Add tab content rendering:
   ```typescript
   {activeTab === 'executors' && <ExecutorsTab />}
   ```

### Step 6: Frontend - Create ExecutorsTab Component

**File**: `apps/web/src/components/SettingsModal.tsx`

Add new `ExecutorsTab` component that:
1. Fetches executor status using SWR
2. Displays each executor with:
   - Name and icon
   - Availability status (green check / red X)
   - Configured path
   - Version (if available)
   - Error message (if not available)
3. Provides a "Refresh" button to re-check status
4. Shows environment variable hints for configuration

UI Design:
```
┌─────────────────────────────────────────────────────────────┐
│ CLI Executors                                               │
│ Check availability of AI coding CLIs for parallel execution│
│                                                             │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ ✓ Claude Code                                           │ │
│ │   Path: claude                                          │ │
│ │   Version: 1.0.0                                        │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                             │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ ✗ Codex CLI                                    [error]  │ │
│ │   Path: codex                                           │ │
│ │   Error: CLI not found at: codex                        │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                             │
│ ┌─────────────────────────────────────────────────────────┐ │
│ │ ✓ Gemini CLI                                            │ │
│ │   Path: gemini                                          │ │
│ │   Version: 0.5.0                                        │ │
│ └─────────────────────────────────────────────────────────┘ │
│                                                             │
│ [Refresh Status]                                            │
│                                                             │
│ ┌─ Environment Variables ─────────────────────────────────┐ │
│ │ ZLOTH_CLAUDE_CLI_PATH=<path>                            │ │
│ │ ZLOTH_CODEX_CLI_PATH=<path>                             │ │
│ │ ZLOTH_GEMINI_CLI_PATH=<path>                            │ │
│ └─────────────────────────────────────────────────────────┘ │
└─────────────────────────────────────────────────────────────┘
```

### Step 7: Update Settings Page (Full Page View)

**File**: `apps/web/src/app/settings/page.tsx`

Add support for the new 'executors' tab in the full-page settings view.

---

## File Changes Summary

| File | Change Type |
|------|-------------|
| `apps/api/src/zloth_api/routes/executors.py` | New file |
| `apps/api/src/zloth_api/routes/__init__.py` | Add import |
| `apps/api/src/zloth_api/main.py` | Register router |
| `apps/web/src/types.ts` | Add types |
| `apps/web/src/lib/api.ts` | Add API client |
| `apps/web/src/components/SettingsModal.tsx` | Add tab + component |
| `apps/web/src/app/settings/page.tsx` | Add tab support |

---

## Technical Notes

### Version Check Commands
Each CLI has different version commands:
- Claude Code: `claude --version` or `claude -v`
- Codex: `codex --version`
- Gemini: `gemini --version`

### Error Handling
- `FileNotFoundError`: CLI not installed or not in PATH
- Timeout (2 seconds): CLI unresponsive
- Non-zero exit code: CLI error (still report as available with warning)

### Caching
- Frontend uses SWR with manual refresh
- No backend caching (always check live status)
