# TNet Cascade RT-DETR ボール検出精度改善案 (モデル中心)

## 概要
ボール検出において、後処理での対応に限界があるため、モデル自体の検出精度向上、特に「特定の箇所での誤検出」の低減を目的とした改善案をまとめる。

## 改善案 (優先度順)

### 優先度: 高 (High) - データセットと学習戦略

1. **Hard Negative Mining (誤検出箇所の重点学習)**
   - **課題**: 特定の箇所（例: コートのライン、ネットの白帯や結び目、照明の反射、選手の靴など）がボールとして誤検出される。
   - **対策**:
     - 誤検出が発生しやすいシーンやオブジェクトを含む画像を重点的に収集し、データセットに追加する。
     - これらを「ボールではない（背景）」として学習させるため、ボールのアノテーションを含まないネガティブサンプルとして追加する。
     - **Negative Classの導入検討**: もし誤検出される物体が特定できる場合（例: 「靴」や「ボトル」）、それらを別クラスとしてアノテーションし、多クラス分類として学習させた上で、推論時にボールクラスのみを使用する手法も有効。

2. **入力解像度 (Input Resolution) の向上**
   - **課題**: ボールは画面全体に対して画素数が少なく、特徴が消失しやすい。
   - **対策**:
     - 学習および推論時の入力解像度を上げる（例: 640x640 -> 960x960, 1280x1280）。
     - これにより小さなオブジェクトの特徴量が保持されやすくなるが、推論速度とのトレードオフに注意する。

3. **Data Augmentation (データ拡張) の最適化**
   - **対策**:
     - **Copy-Paste Augmentation**: ボールの画像を切り抜き、誤検出が発生しやすい背景（ネット際やライン上など）に貼り付けることで、難しいシチュエーションのデータを人工的に増やす。
     - **Mosaic / Mixup の調整**: 学習初期には有効だが、学習終盤（ラスト10-20 epoch）ではこれらを無効化し、より現実に近いデータ分布でFine-tuningを行う。

### 優先度: 中 (Medium) - モデルパラメータと損失関数

4. **損失関数 (Loss Function) のチューニング**
   - **課題**: クラス不均衡により、背景（Easy Negative）に学習が引っ張られている可能性。
   - **対策**:
     - **Focal Loss / VFL (Varifocal Loss)**: パラメータ（$\gamma$, $\alpha$）を調整し、分類が難しいサンプル（Hard Negative）への重み付けを強化する。
     - 誤検出が多い場合は、Classification Loss の重みを相対的に上げ、Bounding Box Regression Loss とのバランスを見直す。

5. **学習率と最適化スケジュールの見直し**
   - **対策**:
     - Cosine Annealing などのスケジューラを使用し、十分なEpoch数学習させる。
     - 事前学習モデル（COCO pre-trained等）からの転移学習を行う際、バックボーンの学習率を小さく設定し、Head部分を重点的に学習させる（Layer-wise Learning Rate Decay）。

### 優先度: 低 (Low) - アーキテクチャ変更

6. **モデルアーキテクチャの変更**
   - **対策**:
     - バックボーンをより強力なもの（ResNet-50/101 -> HGNetv2-L/X など）に変更し、特徴抽出能力を底上げする。
     - RT-DETRの場合、Encoder/Decoderのレイヤー数やQuery数を増やすことで、検出キャパシティを向上させる。

7. **時系列情報の統合 (Temporal Context)**
   - **対策**:
     - 単フレーム検出器としてのRT-DETR改善からは外れるが、動画であることを活かし、複数フレームを入力とするアーキテクチャへの拡張を検討する。

---
**注記**:
本ドキュメントは、提示された課題（特定箇所の誤検出、後処理の限界）に基づき、一般的な物体検出モデル（特にRT-DETR）における精度向上策をまとめたものです。
