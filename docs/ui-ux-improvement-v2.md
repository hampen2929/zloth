# UI/UX 改善提案 v2（dursor）

本ドキュメントは、現状のdursorフロントエンド（Next.js / Tailwind）を前提に、**ユーザーが迷う・待つ・誤る**ポイントをUI/UX観点で洗い出し、優先度付きで改善案をまとめたものです。

## 前提（現状把握）

### 主要フロー（現状）
- **Home**: 指示入力 → 実行器（Models/Claude Code/Codex/Gemini）選択 → Repo/Branch選択 → Task作成＆Run開始
- **Task**: 会話（ユーザーメッセージ）とRun結果カード（Summary/Diff/Logs）を同一画面で閲覧 → 成功RunからPR作成
- **Settings**: Model Profiles / GitHub App / Defaults（repo/branch/prefix/PR作成モード）

### すでに入っている良い点
- **トースト通知**、**スケルトン**、**確認ダイアログ**など、フィードバックの土台がある
- **モバイルサイドバー**とオーバーレイにより、最低限のモバイル動線は確保されている
- `Modal` のフォーカス復帰・Esc閉じなど、アクセシビリティの芽がある

## 改善の狙い（UX原則）

- **認知負荷の低減**: 何をすれば動くのか、次に何が起きるのかを常に明確にする
- **エラー予防**: 入力不足/設定不足を「押してから失敗」ではなく「押す前に理解」へ
- **比較・意思決定の支援**: マルチモデルの価値は「比較できること」なので、比較のUIを強くする
- **信頼性の可視化**: 実行中/待機/失敗の状態が、理由と次の手段まで含めて伝わる

## 優先度付き 改善項目

### P0（詰まりを解消／コア体験を守る）

- **入力バリデーションの“沈黙”をなくす（Home）**
  - **課題**: 指示/Repo/Branch/Models不足時に、送信が通らない・返ってくるが理由が見えにくい。
  - **改善**:
    - 送信ボタン付近に「不足している条件」を1行で表示（例: “リポジトリを選択してください”）。
    - `patch_agent` でモデル未設定時は、**SettingsへのCTA**（“モデルを追加”）を提示。
    - GitHub App 未設定でRepo一覧が取れない場合も、同様に **Settings（GitHub App）へ誘導**。

- **Runとユーザーメッセージの紐付けを“推測”から“確定”に（Task）**
  - **課題**: 現状は「ユーザーメッセージ数に応じてRunを均等割り当て」しており、会話が進むほど誤結合が起きやすい。
  - **改善**:
    - Run作成時に **`message_id` を保存**し、UIはそのIDで厳密にグルーピング。
    - 過去データはフォールバック表示（“推定グループ” ラベル）に留める。

- **Diffの可読性・操作性を一段上げる（Task）**
  - **課題**: 現状のDiffはパッチを素朴に描画しており、ファイル一覧/ジャンプ/折り畳み/コピー等が弱い。
  - **改善**:
    - 左に **ファイル一覧（変更行数＋状態）**、右にDiffの2カラム（狭い画面ではドロワー）。
    - **ファイル内のhunk折り畳み**、大きな差分はデフォルト折り畳み。
    - “Copy patch” / “Download patch” / “Copy file path” のユーティリティ。

- **失敗時の“次の一手”を提示（Task / Run）**
  - **課題**: エラー表示はあるが、ユーザーが取るべき行動が分かりにくい。
  - **改善**:
    - 代表的な失敗パターンを分類（例: 認証/ネットワーク/コンフリクト/依存関係/テスト失敗）。
    - UI上で **推奨アクション**（再実行・別実行器・指示の改善例・Settingsの該当タブ）を表示。

### P1（価値を伸ばす／比較と管理の体験）

- **マルチモデル比較を“結果カードの羅列”から“比較ビュー”へ**
  - **課題**: マルチモデルの強みが、ユーザーの視点では比較しづらい。
  - **改善**:
    - 同一メッセージ配下のRunに **Compareモード**（Summary比較、Files changed比較、Diffの切替）。
    - “採用候補” をピン留めできる（最終的にPRを作るRunを選びやすくする）。
    - 成功/失敗/警告数などの **サマリー行** をグループ上部に表示。

- **Task履歴の探索性向上（Sidebar）**
  - **改善**:
    - 検索（タイトル/Repo）・フィルタ（成功PRあり/最近/Repo別）・セクション（Today/This week）。
    - サイドバーを **折り畳み可能** にし、作業領域を広げる（特にラップトップ）。

- **PR作成体験の統一（Auto作成/Link作成）**
  - **課題**: “Create PR” がモードにより挙動が異なり、成功状態の表現も分散しやすい。
  - **改善**:
    - PR作成ボタン周辺に「現在の設定モード」を明示。
    - Linkモード時は “PR作成リンクを開いた後に自動検出します” を固定表示し、待機状態を見える化。

### P2（品質・アクセシビリティ・一貫性）

- **アクセシビリティ（A11y）**
  - **改善**:
    - `Modal` のフォーカストラップを“最初にフォーカス”だけでなく、**Tab循環**まで対応。
    - タブUI（Settings/Run）に `aria-controls` / `id` を付与して、関係性を明確にする。
    - `prefers-reduced-motion` への配慮（アニメーション抑制）。
    - 重要な状態変化（Run完了/失敗）を `aria-live` の領域で補助。

- **マイクロコピーの統一**
  - **課題**: UI文言が英語中心で、表現の粒度が揃っていない。
  - **改善**:
    - 用語集を作り、UI上の用語（Task/Run/Executor/Model/Branch）を統一。
    - “Run / Execute / Submit” 等の動詞を統一し、学習コストを下げる。

- **視覚的一貫性（密度・余白・アイコン）**
  - **改善**:
    - “絵文字混在（例: 📋）” は原則アイコンに統一。
    - ステータス表現（色/ラベル/アイコン）を `StatusBadge` に集約し、重複実装を削減。

### P3（将来投資）

- **i18n（日本語UI対応）**
  - **改善**:
    - UI文言を辞書化し、日英切替（最初はSettingsにトグル）。
    - 日付表記や相対時間をローカライズ（`formatRelativeTime` の日本語化）。

- **観測性のUX（“何が起きたか”の説明）**
  - **改善**:
    - Runの“入力→実行→成果物→PR”の履歴を時系列で俯瞰できるタイムライン。
    - “このRunが触ったファイル”から直接Diff該当箇所へジャンプ。

## 画面別の具体提案

### Home（タスク作成）
- **段階表示（Step）**: Repo/Branch/Executor/Models/Instruction を“ひと塊”ではなく「必要条件のチェックリスト」として見せる
- **空状態の導線**:
  - モデル0件: “Settings → Models へ” ボタンをその場に出す
  - GitHub未設定: “Settings → GitHub App へ” を表示し、Repo選択の理由を説明
- **入力補助**: 例文チップ（“バグ修正”“テスト追加”“設計レビュー”など）を用意し、最初の体験を滑らかにする

### Task（会話＋結果）
- **グループヘッダー**: ユーザーメッセージごとに「実行したモデル数/成功数/失敗数/警告数」を要約
- **Runカード**:
  - 重要情報（成功/失敗/警告/変更ファイル数）をヘッダーに集約し、開かなくても判断可能に
  - Logsは検索（Ctrl/Cmd+FではなくUI検索）とコピーを追加
- **Diff**:
  - ファイル一覧＋ジャンプ
  - 行数が多いhunkの折り畳み
  - “変更なし” のときは、なぜそうなったか（例: 失敗/空パッチ/指示不足）を補足

### Settings
- **安全性と理解の強化**:
  - GitHub Appの設定は“どこで取得するか”の短い手順（3ステップ）をUI内に持つ
  - API Keyは保存後に「保存されました（復元不可）」などの安心文言
- **Defaults**:
  - リポジトリ/ブランチの選択は検索可能に（数が増えると選択が辛い）

## 成功指標（KPI）

- **タスク開始成功率**: “送信できない”状態からの離脱率を下げる
- **初回PR作成までの時間**: 初見ユーザーがPRを作るまでの平均時間
- **Run比較の利用率**: Compareビュー利用、採用Runのピン留め率
- **エラー復帰率**: 失敗Run後に再実行/設定修正/別実行器へ進めた割合
- **アクセシビリティスコア**: Lighthouse A11y 90+（最低ライン）

## 実装方針（UI/UX観点）

- **“次に何をすべきか”を画面上に残す**（空状態・エラー・設定不足の全て）
- **比較のユースケースを中心に設計する**（dursorの差別化ポイント）
- **情報の重複を減らし、重要情報を先頭に集約する**（Runカード、ヘッダー、サマリー）

